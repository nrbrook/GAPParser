<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>GAP Parser by nrbrook</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">GAP Parser</h1>
      <h2 class="project-tagline">BTLE GAP Packet parser</h2>
      <a href="https://github.com/nrbrook/GAPParser" class="btn">View on GitHub</a>
      <a href="https://github.com/nrbrook/GAPParser/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/nrbrook/GAPParser/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h3>Parse a GAP packet:</h3>
      <form id="packetForm">
          <label for="packet">Packet: </label>
          <input type="text" name="packet" id="packet" />
          <button>Parse</button>
      </form>
      <br />
      <div id="parsedContent">
      </div>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/nrbrook/GAPParser">GAP Parser</a> is maintained by <a href="https://github.com/nrbrook">nrbrook</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
  <script src="GAPParser.js"></script>
  <script>
    var form = $('#packetForm').submit(function(e) {
      e.preventDefault();
      var container = $('#parsedContent');
      var input = $('#packet').val().trim();
      if(!input.length) {
        container.html('<p>No data.</p>');
        return false;
      }
      var fields = GAPParser(input);
      
      if(fields === null) {
        container.html('<p>Invalid packet!</p>')
      } else {
        var table = $('<table><tr><th>Type (Hex)</th><th>Type</th><th>Data (hex)</th><th>Data</th></tr></table>');
        for(var i = 0; i < fields.length; i++) {
          var field = fields[i];
          table.append('<tr><td>'+field.typeHex()+'</td><td>'+field.typeDescription()+'</td><td>'+field.dataHex()+'</td><td>'+(field.dataDescription() || 'Cannot parse')+(field.truncatedBy > 0 ? ' <span style="color:red;">(invalid length, missing '+field.truncatedBy+' bytes)</span>' : '')+'</td></tr>');
        }
        container.html(table);
      }
      return false;
    });
  </script>
  </body>
</html>
